<div class="container py-4">
    <div>
        <app-breadcrum [items]="[
              { label: 'Home', url: '/admin/dashboard' },
              { label: 'Employees List', url: '/admin/employee' },
            ]"></app-breadcrum>
    </div>
    <app-search-bar [searchOptions]="searchFields" (search)="onSearchHandler($event)">
    </app-search-bar>
    <div>
        <div class="text-end mb-3">
            <button class="btn btn-info me-2" (click)="exportEmployees()">Export</button>
            <button class="btn btn-secondary me-2" (click)="openBulkUploadModal()">
                Bulk Create
            </button>
            <button class="btn btn-yes" (click)="onCreate()">
                Add New Employee
            </button>
        </div>
    </div>
    <div class="col-12">
        <div *ngIf="loading" class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
            <app-custom-table 
            *ngIf="!loading"
            [columns]="columns" 
            [data]="clientsList" 
            [actions]="actions" 
            (rowClick)="onRowClick($event)"
            (actionClick)="onActionClick($event)"
            [totalRecords]="totalEmployees"
            [pageSize]="params.pageSize"
            [page]="params.page -1"
            (pageChange)="handlePageChange($event)"
            [isLoading]="loading">
            </app-custom-table>
    </div>
    <app-delete-modal 
    [visible]="showDeleteModal()" 
    [employee]="selectedUser()" 
    (close)="closeDeleteModal()"
    (confirm)="onDelete($event)" 
    />
    <app-create-update-employee-modal 
    [visible]="showCreateUpdateModal()"
    (close)="closeModal()"
    [formData]="selectedUser()"
    [isEdit]="isEditMode()"
    [submit]="submitModal"
    (employeeCreated)="fetchEmployees()"
    />
</div>

<div class="modal" [ngClass]="{'show d-block': showBulkUploadModal}" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Create Employees</h5>
                <button type="button" class="btn-close" (click)="closeBulkUploadModal()"></button>
            </div>
            <div class="modal-body">
                <p>Upload an Excel file with employee data. <a href="assets/employees.xlsx" download>Download sample file</a></p>
                
                <div class="input-group">
                    <input type="file" class="form-control" id="inputGroupFile04" (change)="onFileSelected($event)" accept=".xlsx" hidden #fileInput>
                    <input type="text" class="form-control" [value]="selectedFile?.name || ''" placeholder="Choose an Excel file" readonly>
                    <button class="btn btn-outline-secondary" type="button" (click)="fileInput.click()">Browse</button>
                </div>
                <div *ngIf="fileError" class="text-danger mt-2">{{fileError}}</div>

                <div *ngIf="uploadProgress > 0" class="progress mt-3">
                    <div class="progress-bar" role="progressbar" [style.width.%]="uploadProgress" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">{{uploadProgress}}%</div>
                </div>
                <div *ngIf="uploadResult" class="alert alert-info mt-3">
                    <p>Created: {{uploadResult.created_count}} users</p>
                    <ng-container *ngIf="uploadResult.errors && uploadResult.errors.length > 0">
                        <p>Errors: {{uploadResult.errors.length}}</p>
                        <ul>
                            <li *ngFor="let error of uploadResult.errors">{{error}}</li>
                        </ul>
                    </ng-container>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeBulkUploadModal()">Close</button>
                <button type="button" class="btn btn-primary" (click)="uploadFile()" [disabled]="!selectedFile">Upload</button>
            </div>
        </div>
    </div>
</div>